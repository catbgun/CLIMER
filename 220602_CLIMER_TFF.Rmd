---
title: "220602_CLIMER_TFF"
author: "CBG"
date: "2 6 2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*Installation of packages* 
```{r}
#install.packages(c("ggplot2", "lubridate", "scales", "plyr"))
Packages <- c("ggplot2", "lubridate", "scales", "plyr", "dplyr", "Rmisc")
lapply(Packages, library, character.only = TRUE)
```

### Load Data
```{r Load file}
d1 <- read.table("CLIMER TFF R COMPLETE.txt", sep = "\t", header = TRUE, fill=TRUE)
```

### Data preparation
- recognize date as date
```{r Data preparation}
d1$Date <- as.Date(d1$Date,format = "%d.%m.%Y")
d1$Month <- month(d1$Date, label=TRUE) #Not working, find other way from other projects
d1$year <- year(d1$Date) #Not working, find other way from other projects


d1$Position <- factor(d1$Position,
                      levels = c("Inlet", "Hypo", "Outlet"),ordered = TRUE)
d1$Size <- factor(d1$Size,
                  levels = c("LMW", "HMW"),ordered = TRUE)
d1$Date <- factor(d1$Date,
                  levels = c("15.09.2016", "25.01.2017", "01.04.2017", "06.06.2017", "22.09.2017", 
                             "29.05.2018", "20.09.2018","17.10.2018", "21.05.2019", "07.06.2019"),ordered = TRUE)

```

#1) Boxplot
- look for differences between LMW and HMW optical properties

```{r Boxplot}
ggplot(d1, aes(x=Size, y= DOC_UiO))+
  geom_boxplot()+
  facet_grid(.~Position)

```
#2) Barplplot
- look for seasonal differences in the distribution between LMW and HMW
```{r}
LMW <- subset(d1, Size=LMW)
ggplot(d1, aes(x=Date, y=sUVa, fill=Months))+
  geom_bar(position="dodge", stat="identity")+
  facet_grid(Size~.)

```



#2) Barplot: seasonal, relative. Muligens det samme som i punkt 3...
- make summrary before plotting
```{r}
dx <- na.omit(d1)
DOC <- select(d1, DOC_frac, Size, Position)
Hg <- select(d1, THg, MeHg, THg_DOC, MeHg_DOC, Size, Position)

d <- summarySE(Hg, measurevar="THg_DOC", groupvar=c("Position", "Size"))
head(d)

ggplot(d1, aes(x=Position, y=THg_DOC, fill=factor(Size))) + 
  geom_bar(stat="identity", position=position_dodge())
theme(axis.text.y = element_text(size= 20, colour="black"),
      axis.title.x = element_text(size = 20, margin=margin(20,0,0,0)),
      axis.title.y = element_text(size = 24, margin=margin(0,20,0,0)),
      strip.text.x = element_text(size = 26),
      axis.text.x = element_text(angle=0, vjust=1, size = 24, colour="black"),
      plot.title=element_text(size=30))+
  labs(title = "MeHg/DOC", x = "", y = "MeHg:DOC (ng/mg)")+
  geom_errorbar(aes(ymin=MeHg_DOC-sd, ymax=MeHg_DOC+sd), position=position_dodge(0.9),
                width=.2, col="black")
```

#2) VELDIG BRA BAR FOR TID PÅ X-AKSE 

```{r}
#for the facet, the side of the variable you put the .~ determined if vertical or horisontal
dx$Date = as.Date(dx$Date)
HMW<- subset(d1, Size == "HMW")
LMW<- subset(d1, Size == "LMW")
#|Position == "Hypolimnion"
#See all data next to each other either with natural or compressed x-axis
ggplot(data = subset(d1, Position == "Inlet"|Position == "Outlet"),
       aes(y=DOC, x=Date, fill=(factor(Position))))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  geom_bar(position=position_dodge(), stat="identity", size=1, linetype="dashed")+
  facet_grid(Size~., scale="free")
ggtitle("sUVa")

```


# 3) For å se om forskjeller i gjennomsnitt mellom inlet, hypo og outlet. Lager et sammendrag først og så plottes det

```{r}
library(Rmisc)
head(dx)
dx =na.omit(dx)
ds <- summarySE(dx, measurevar="sUVa", groupvar=c("Size", "Position"))
head(ds)
length(dx$Position)

head(ds)
# Convert dose to a factor variable
df2$dose=as.factor(df2$dose)

ggplot(ds, aes(x=factor(Position), y=Labile)) + 
  geom_bar(stat="identity", position=position_dodge())+
  geom_errorbar(aes(ymin=Labile-sd, ymax=Labile+sd), width=0.2, position=position_dodge(.9))+
  facet_grid(. ~ factor(Size))

```


#4) #4) Correlation plots 
#Correlation plots, LMW/HMW, and INlet/Outlet

```{r}
d <- subset(d, Lake == "Inlet"| Lake =="Outlet")
d <- subset(d, Fraction == "LMW"| Fraction =="HMW")
head(dx)
#IMPORTANT!!! Correlation plot for biodeg and parameters
ggplot(dx, aes(DOC_natural, DOC_TFF))+
  geom_point(aes(colour=interaction(factor(Size))), size=6)+
  geom_smooth(method = "lm", se = FALSE, colour="black")+
  facet_grid(. ~ factor(Position))+
  theme(axis.text.y = element_text(size= 22),
        axis.title.x = element_text(size = 24, margin=margin(20,0,0,0)),
        axis.title.y = element_text(size = 24, margin=margin(0,20,0,0)),
        strip.text.x = element_text(size = 32),
        axis.text.x = element_text(angle=0, hjust=0.5, vjust=0, size = 24),
        plot.title=element_text(size=30, face="bold"),
        legend.text=element_text(size=26),
        legend.title = element_blank())
labs(title = "DOM Size and Aromaticity", x = "sUVa (Abs254:DOC*100)", y = "Rate of DOC decay:DOC (/h)")
ylim(0, -0.007)+
  scale_colour_manual(values=c("#F8766D", "#7CAE00", "#00BFC4"))+
  xlim(0, 8)
```




